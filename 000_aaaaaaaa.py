translation = {'098': 'offspringName', '099': '_', '023': '0', '090': 'string', '091': 'random.choice({})', '092': '#################################makeOffspring', '093': 'makeOffspring', '094': 'locationID', '095': 'uniqueID', '096': '8', '097': 'alphanumeric', '010': '', '132': 'random.uniform({},{})', '131': 'random.random()', '130': 'tryToMove', '014': 'selfName', '015': 'world', '135': 'initiateInteraction', '134': '#################################initiateInteraction', '018': '.5', '019': '3', '139': '#################################interact', '138': 'interact', '056': '{}.format(*{})', '120': '{} % {}', '121': 'int({})', '122': '1000', '026': '-{}', '124': 'move', '125': 'distance', '126': 'random.random', '127': 'newName', '128': 'os.rename({},{})', '129': '#################################tryToMove', '029': '{}({})', '028': '/', '133': '100', '011': 'global {}', '012': 'metabolism', '013': 'codonLength', '137': 'otherName', '136': 'organisms', '016': 'sightDistance', '017': '{} = {}', '144': 'fullResponse', '115': 'str({})', '114': 'num', '117': '#################################getNewPosition', '039': '{}:{}', '111': 'name', '110': 'splitName', '113': 'intToString', '055': '{}.append({})', '032': 'dedent', '033': '#################################GetTree', '030': 'os.getcwd', '031': '300', '036': 'container', '037': 'codon', '034': 'getTree', '035': 'position', '174': 'organisms.remove("genomeGenerator.py")', '050': 'for {} in {}:', '051': 'i', '052': 'range({})', '170': 'type({})', '108': 'close', '109': '#################################splitName', '085': 'chars', '049': '{}', '048': "'{}'", '102': 'open', '046': 'if {}:', '100': '.py', '149': 'acting_organism', '043': '{} += {}', '042': 'translation', '041': 'aacid', '105': 'write', '076': '5', '150': 'json.dumps({})', '153': '[{}]', '047': '{} != {}', '075': '({})', '058': '#################################Translate', '059': 'translate', '103': 'w', '054': 'value', '155': 'os.listdir({})', '175': 'print {}', '057': 'return {}', '173': 'None', '172': '{}.get({})', '171': 'dict', '053': '{}.count({})', '101': 'offspring', '070': ':', '106': 'str', '156': '#################################findNearbyOrganisms', '145': '{}.communicate({})', '107': '"', '159': 'nearby', '104': '{}.{}({})', '040': '{} + {}', '061': "''", '060': 'output', '063': 'while {}:', '062': 'codeList', '065': 'len({})', '064': '{} < {}', '067': 'line', '066': 'indent', '069': '-1', '068': '{} == {}', '168': 'json.loads({})', '169': 'except:', '164': '#################################main', '165': 'startConditions', '166': 'raw_input({})', '167': 'try:', '160': 'organismLocation', '161': '{} or {}', '162': 'abs({})', '163': '{} > {}', '022': 'sys.argv', '038': 'genome', '116': '{} - {}', '151': '#################################getAllOrganisms', '077': 'elif {}:', '074': '{}+{}', '152': 'getAllOrganisms', '072': '{}*{}', '073': "' '", '157': 'findNearbyOrganisms', '071': '\\n', '045': '[]', '158': 'location', '112': '#################################intToString', '078': '{} -= {}', '079': 'else:', '044': 'newContainer', '119': 'direction', '118': 'getNewPosition', '146': 'parsedResponse', '147': '#################################getMessage', '089': '0123456789abcdefghijklmnopqrstuvwxyz', '088': '0123456789', '142': 'otherOrganism', '143': 'subprocess.Popen(["python",{}],bufsize=1,stdin=subprocess.PIPE,stdout=subprocess.PIPE,stderr=subprocess.PIPE,universal_newlines=True)', '140': 'message', '141': 'getMessage', '083': 'kind', '082': 'length', '081': 'getRandomString', '080': '#################################getRandomString', '087': 'numbers', '086': 'abcdefghijklmnopqrstuvwxyz', '148': 'dict({})', '084': 'letters', '003': 'random', '002': 'sys', '001': '{},{}', '000': 'import {}', '007': '#################################getTraits', '006': 'subprocess', '005': 'json', '004': 'os', '154': 'organism', '009': 'getTraits', '008': 'def {}({}):', '025': '\\\\', '024': '"{}"', '027': '1', '123': '#################################move', '021': '{}.split({})', '020': '{}[{}]'}
genome = '000001002001003001004001005006007008009010011012011013011014011015011016017012018017013019017014020021020021020022023024025026027024028026027017015029030010017016031032033008034001035036017037020038039035040035013017041020042037043035013017044045046047041048049050051052053041048049017001054035029034001035044055044054032017041056041044032057001041035032058008059010017060061017062045017035023063064035065038017001054035029034001035062055062054032017066023050067062046068020067069048070043060040048071072073074075072076066067043066027032077068067048032078066027032079043060040048071072073074075072076066067032032057060032080008081001082083046068083048084017085048086032077068083048087017085048088032079017085048089032017090061050051052082043090091085032057090032092008093010017094029081001019048087017095029081001096048097017098040094040048099040095048100017101029102001098048103104101105040048017042010029106042104101105040048071040048017038107040038048107104101105029059010104101108010032109008110111057021111024099032112008113001114082017114115114050051052116082065114017114040024023114032057114032117008118001035119057120075040121035119122032123008124125011014017001035095021014024099046064126018017119027032079017119026027032050051052125017035029113001029118001035119019017127040035040024099095128014127017014127032032129008130010046064131012017125121072012132027133029124125032032134008135136017137091136029138137032139008138137017140029141010017142143137017144145142140017146020144023032147008141010017140148010017020140024149014057150140032151008152015017136153010050154155015046068020154039026019010024100055136154032032057136032156008157136017158121020029110014023017159153010050154136046047154014017160121020029110154023046161064162116160158016163162116160158075116122016055159154032032032057159032164029009010017165166010167017165168165032169017165148010032046047170165171017165148010032046068172165024149173029130010017136029152015174017159029157136046159029135159032029093010032079029130010175029141010'
import sys,random,os,json,subprocess
#################################getTraits
def getTraits():
    global metabolism
    global codonLength
    global selfName
    global world
    global sightDistance
    metabolism = .5
    codonLength = 3
    selfName = sys.argv[0].split("\\")[-1].split("/")[-1]
    world = os.getcwd()
    sightDistance = 300
#################################GetTree
def getTree(position,container):
    codon = genome[position:position + codonLength]
    aacid = translation[codon]
    position += codonLength
    newContainer = []
    if aacid != '{}':
        for i in range(aacid.count('{}')):
            value,position = getTree(position,newContainer)
            newContainer.append(value)
        aacid = aacid.format(*newContainer)
    return aacid,position
#################################Translate
def translate():
    output = ''
    codeList = []
    position = 0
    while position < len(genome):
        value,position = getTree(position,codeList)
        codeList.append(value)
    indent = 0
    for line in codeList:
        if line[-1] == ':':
            output += '\n' + ' '*(5*indent)+line
            indent += 1
        elif line == 'dedent':
            indent -= 1
        else:
            output += '\n' + ' '*(5*indent)+line
    return output
#################################getRandomString
def getRandomString(length,kind):
    if kind == 'letters':
        chars = 'abcdefghijklmnopqrstuvwxyz'
    elif kind == 'numbers':
        chars = '0123456789'
    else:
        chars = '0123456789abcdefghijklmnopqrstuvwxyz'
    string = ''
    for i in range(length):
        string += random.choice(chars)
    return string
#################################makeOffspring
def makeOffspring():
    locationID = getRandomString(3,'numbers')
    uniqueID = getRandomString(8,'alphanumeric')
    offspringName = locationID + '_' + uniqueID + '.py'
    offspring = open(offspringName,'w')
    offspring.write('translation = ' + str(translation))
    offspring.write('\n' + 'genome = "' + genome + '"')
    offspring.write(translate())
    offspring.close()
#################################splitName
def splitName(name):
    return name.split("_")
#################################intToString
def intToString(num,length):
    num = str(num)
    for i in range(length - len(num)):
        num = "0" + num
    return num
#################################getNewPosition
def getNewPosition(position,direction):
    return (int(position) + direction) % 1000
#################################move
def move(distance):
    global selfName
    position,uniqueID = selfName.split("_")
    if random.random < .5:
        direction = 1
    else:
        direction = -1
    for i in range(distance):
        position = intToString(getNewPosition(position,direction),3)
        newName = position + "_" + uniqueID
        os.rename(selfName,newName)
        selfName = newName
#################################tryToMove
def tryToMove():
    if random.random() < metabolism:
        distance = int(metabolism*random.uniform(1,100))
        move(distance)
#################################initiateInteraction
def initiateInteraction(organisms):
    otherName = random.choice(organisms)
    interact(otherName)
#################################interact
def interact(otherName):
    message = getMessage()
    otherOrganism = subprocess.Popen(["python",otherName],bufsize=1,stdin=subprocess.PIPE,stdout=subprocess.PIPE,stderr=subprocess.PIPE,universal_newlines=True)
    fullResponse = otherOrganism.communicate(message)
    parsedResponse = fullResponse[0]
#################################getMessage
def getMessage():
    message = dict()
    message["acting_organism"] = selfName
    return json.dumps(message)
#################################getAllOrganisms
def getAllOrganisms(world):
    organisms = []
    for organism in os.listdir(world):
        if organism[-3:] == ".py":
            organisms.append(organism)
    return organisms
#################################findNearbyOrganisms
def findNearbyOrganisms(organisms):
    location = int(splitName(selfName)[0])
    nearby = []
    for organism in organisms:
        if organism != selfName:
            organismLocation = int(splitName(organism)[0])
            if abs(organismLocation - location) < sightDistance or abs(organismLocation - location) > (1000 - sightDistance):
                nearby.append(organism)
    return nearby
#################################main
getTraits()
startConditions = raw_input()
try:
    startConditions = json.loads(startConditions)
except:
    startConditions = dict()
if type(startConditions) != dict:
    startConditions = dict()
if startConditions.get("acting_organism") == None:
    tryToMove()
    organisms = getAllOrganisms(world)
    organisms.remove("genomeGenerator.py")
    nearby = findNearbyOrganisms(organisms)
    if nearby:
        initiateInteraction(nearby)
    makeOffspring()
else:
    tryToMove()
    print getMessage()
